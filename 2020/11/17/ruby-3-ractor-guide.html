<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.25.1 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ractor 下多线程 Ruby 程序指南 - Coderemixer 代码混音师</title>
<meta name="description" content="什么是 Ractor?">


  <meta name="author" content="CodeRemixer">
  
  <meta property="article:author" content="CodeRemixer">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Coderemixer 代码混音师">
<meta property="og:title" content="Ractor 下多线程 Ruby 程序指南">
<meta property="og:url" content="https://coderemixer.com/2020/11/17/ruby-3-ractor-guide">


  <meta property="og:description" content="什么是 Ractor?">







  <meta property="article:published_time" content="2020-11-17T15:30:24+08:00">






<link rel="canonical" href="https://coderemixer.com/2020/11/17/ruby-3-ractor-guide">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://coderemixer.com/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Coderemixer 代码混音师 Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>


  
    <script src="/assets/js/mathjax.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Coderemixer 代码混音师
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">首页</a>
            </li><li class="masthead__menu-item">
              <a href="/about">关于</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/dsh0416">GitHub</a>
            </li><li class="masthead__menu-item">
              <a href="/atom.xml">RSS</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://coderemixer.com/">
        <img src="/assets/images/bio-photo.png" alt="CodeRemixer" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://coderemixer.com/" itemprop="url">CodeRemixer</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>一个用来发牢骚的网站，以至于无法对所说的话负责。<br /><br /> 文章若无特别声明，皆采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 进行许可。</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Shanghai ⊕ Tokyo</span>
        </li>
      

      
        
          
            <li><a href="mailto:dsh0416@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/dsh0416" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github-square" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://twitter.com/DeltonDing" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-square-x-twitter" aria-hidden="true"></i><span class="label">X (Twitter)</span></a></li>
          
        
          
            <li><a href="https://www.xiaohongshu.com/user/profile/6030b59300000000010044d5" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-heart" aria-hidden="true"></i><span class="label">小红书</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ractor 下多线程 Ruby 程序指南">
    <meta itemprop="description" content="什么是 Ractor?">
    <meta itemprop="datePublished" content="2020-11-17T15:30:24+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://coderemixer.com/2020/11/17/ruby-3-ractor-guide" class="u-url" itemprop="url">Ractor 下多线程 Ruby 程序指南
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-11-17T15:30:24+08:00">November 17, 2020</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="什么是-ractor">什么是 Ractor?</h2>

<p>Ractor 是 Ruby 3 新引入的特性。Ractor 顾名思义是 Ruby 和 Actor 的组合词。Actor 模型是一个基于通讯的、非锁同步的并发模型。基于 Actor 的并发模型在 Ruby 中有很多应用，比如 <code class="language-plaintext highlighter-rouge">concurrent-ruby</code> 中的 <code class="language-plaintext highlighter-rouge">Concurrent::Actor</code>。Concurrent Ruby 虽然引入了大量的抽象模型，允许开发高并发的应用，但是它并不能摆脱 Ruby 的 GIL (Global Interpreter Lock)，这使得同一时间，只有一个线程是活跃的。所以通常 <code class="language-plaintext highlighter-rouge">concurrent-ruby</code> 需要搭配无锁的 JRuby 解释器使用。然而，直接解除 GIL 锁会导致大量默认 GIL 可用的依赖出现问题，在多线程开发中会产生难以预料的线程竞争问题。</p>

<p>去年在 RubyConf China 的时候，我问 matz 说 90 年代多核的小型机以及超级计算机已经变得非常普遍了，为什么会把 Ruby 的多线程设计成这样呢？matz 表示，他当时还在用装着 Windows 95 的 PC，如果他知道以后多核会那么普遍，他也不会把 Ruby 设计成这样。</p>

<h2 id="什么数据可以在-ractor-间共享">什么数据可以在 Ractor 间共享？</h2>

<p>但是，历史遗留问题依然需要解决。随着 Fiber Scheduler 在 Ruby 3 引入来提高 I/O 密集场景下单一线程利用率极低的问题；我们需要进一步解决，计算密集场景下，多线程的利用率。</p>

<p>为了解决这一问题，Ruby 3 引入了 Ractor 模型。Ractor 本质来说还是 Thread 线程，但是 Ractor 做了一系列的限制。首先，锁是不会在 Ractor 之间共享的；也就是说，不可能有两个线程争抢同一个锁。Ractor 和 Ractor 之间可以传递消息。Ractor 内部具有全局锁，确保 Ractor 内的行为和原先 Thread 是一致的。传递消息必须是值类型的，这意味着不会有指针跨 Ractor 生存，也会避免数据竞争问题。简而言之，Ractor 把每个 Thread 当作一个 Actor。</p>

<p>但 Ruby 没有真正的值类型。但值类型的本质就是用拷贝来替代引用。我们要做的就是确保 Ruby 对象的可拷贝性。我们查看 Ractor 的文档，我们可以看到这个的严格描述：</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ractors don't share everything, unlike threads.
<span class="p">
*</span> Most objects are <span class="ge">*Unshareable objects*</span>, so you don't need to care about thread-safety problem which is caused by sharing.
<span class="p">*</span> Some objects are <span class="ge">*Shareable objects*</span>.
<span class="p">  *</span> Immutable objects: frozen objects which don't refer to unshareable-objects.
<span class="p">    *</span> <span class="sb">`i = 123`</span>: <span class="sb">`i`</span> is an immutable object.
<span class="p">    *</span> <span class="sb">`s = "str".freeze`</span>: <span class="sb">`s`</span> is an immutable object.
<span class="p">    *</span> <span class="sb">`a = [1, [2], 3].freeze`</span>: <span class="sb">`a`</span> is not an immutable object because <span class="sb">`a`</span> refer unshareable-object <span class="sb">`[2]`</span> (which is not frozen).
<span class="p">  *</span> Class/Module objects
<span class="p">  *</span> Special shareable objects
<span class="p">    *</span> Ractor object itself.
<span class="p">    *</span> And more...
</code></pre></div></div>

<h2 id="ractor-性能提升测试">Ractor 性能提升测试</h2>

<p>为了测试出 Ractor 的效果，我们需要一个计算密集的场景。最计算密集的场景，当然就是做数学计算本身。比如我们有下面一个程序：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">DAT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="mi">72072000</span><span class="p">).</span><span class="nf">to_a</span>
<span class="nb">p</span> <span class="no">DAT</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="p">}.</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">+</span><span class="p">)</span>
</code></pre></div></div>

<p>这个程序计算 0 到 72072000 的平方和。我们运行一下这个程序，得到运行时间是 8.17s。</p>

<p>如果我们用传统的多线程来写，我们可以把程序写成这样：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">THREADS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="no">LCM</span> <span class="o">=</span> <span class="mi">72072000</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="no">THREADS</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">r</span> <span class="o">=</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="p">(((</span><span class="no">LCM</span><span class="o">/</span><span class="no">THREADS</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">...</span><span class="p">((</span><span class="no">LCM</span><span class="o">/</span><span class="no">THREADS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))).</span><span class="nf">to_a</span>
    <span class="n">res</span> <span class="o">&lt;&lt;</span> <span class="n">dat</span><span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">}.</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">+</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">r</span>
<span class="k">end</span>

<span class="n">t</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="nf">join</span> <span class="p">}</span>
<span class="nb">p</span> <span class="n">res</span><span class="p">.</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">+</span><span class="p">)</span>
</code></pre></div></div>

<p>运行后，我们发现，虽然确实创建了 8 个系统线程，但是总运行时间变成了 8.21s。没有显著的性能提升。</p>

<p>使用 Ractor 重写程序，主要需要改变我们子线程内需要访问外面的 <code class="language-plaintext highlighter-rouge">i</code> 变量，我们用消息的方法传递进去，改进后的代码会变成这样：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">THREADS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="no">LCM</span> <span class="o">=</span> <span class="mi">72072000</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>

<span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="no">THREADS</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">r</span> <span class="o">=</span> <span class="no">Ractor</span><span class="p">.</span><span class="nf">new</span> <span class="n">i</span> <span class="k">do</span> <span class="o">|</span><span class="n">j</span><span class="o">|</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="p">(((</span><span class="no">LCM</span><span class="o">/</span><span class="no">THREADS</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">...</span><span class="p">((</span><span class="no">LCM</span><span class="o">/</span><span class="no">THREADS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))).</span><span class="nf">to_a</span>
    <span class="n">dat</span><span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">}.</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">+</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="n">r</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">t</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span> <span class="n">t</span><span class="p">.</span><span class="nf">take</span> <span class="p">}.</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">+</span><span class="p">)</span>
</code></pre></div></div>

<p>其结果如何呢？我们根据不同的线程数量进行了测试。</p>

<table>
  <thead>
    <tr>
      <th><strong>Threads</strong></th>
      <th><strong>AMD Ryzen 7 2700x</strong></th>
      <th><strong>Intel i7-6820HQ</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>1</strong></td>
      <td>8.171</td>
      <td>12.027</td>
    </tr>
    <tr>
      <td><strong>2</strong></td>
      <td>4.483</td>
      <td>6.913</td>
    </tr>
    <tr>
      <td><strong>3</strong></td>
      <td>4.874</td>
      <td>6.755</td>
    </tr>
    <tr>
      <td><strong>4</strong></td>
      <td>2.353</td>
      <td>6.188</td>
    </tr>
    <tr>
      <td><strong>5</strong></td>
      <td>2.429</td>
      <td>5.154</td>
    </tr>
    <tr>
      <td><strong>6</strong></td>
      <td>2.259</td>
      <td>5.320</td>
    </tr>
    <tr>
      <td><strong>7</strong></td>
      <td>1.908</td>
      <td>5.368</td>
    </tr>
    <tr>
      <td><strong>8</strong></td>
      <td>2.156</td>
      <td>5.754</td>
    </tr>
    <tr>
      <td><strong>9</strong></td>
      <td>2.136</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>10</strong></td>
      <td>3.159</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>11</strong></td>
      <td>2.577</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>12</strong></td>
      <td>2.679</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>13</strong></td>
      <td>2.787</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>14</strong></td>
      <td>2.615</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>15</strong></td>
      <td>2.197</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>16</strong></td>
      <td>2.303</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/images/ractor-benchmark.png" alt="Ractor Benchmark" /></p>

<p>Ractor 确实改善了多线程全局解释锁的问题。</p>

<h2 id="显微镜下的-ractor">显微镜下的 Ractor</h2>

<p>我使用了 AMD uProf（对于 Intel CPU，可以使用 Intel VTune）进行 CPU 运算情况的统计。为了降低睿频对单线程性能的影响，我将 AMD Ryzen 7 2700x 全核心锁死 4.2GHz。</p>

<p><img src="/assets/images/ractor-uprof.png" alt="uProf Results" /></p>

<p>对于 AMD Ryzen 7 2700x，4 线程比单一线程快了 3 倍多。到 4 线程，比单一线程快了约 4 倍。AMD Ryzen 7 2700x 是一款 8 核心 16 线程的 CPU。同时，每 4 个核心组成一个 CCX，跨 CCX 的内存访问有额外的代价。这使得 4 线程内性能提升很显著，超过 4 线程后受限于 CCX 和 SMT，性能提升变得比较有限。其表现是随着线程数的增加，IPC（每时钟周期指令数）开始下降。在单线程运算时，每时钟周期 CPU 可以执行 2.42 个指令；但到了 16 线程运算时，每时钟周期 CPU 只能执行 1.40 个指令。同时，更多的线程意味着更复杂的操作系统的线程调度，使得多核的利用率越来越低。</p>

<p>同样，对于 Intel i7-6820HQ，我们得到了类似的结论。这是一款 4 核 8 线程的 CPU，由于第 5 个线程开始需要使用 HT，从而提升变得很有限。</p>

<h2 id="ractor-如何改善现有-ruby-程序的性能">Ractor 如何改善现有 Ruby 程序的性能？</h2>

<p>Ractor 的引入除了可以改善计算密集场景下的运算效率，对于现有大型 Ruby Web 程序的内存占用也是有积极意义的。现有 Web 服务器，比如 puma，由于 I/O 多路复用性能极其低下，通常会使用多线程 + 多进程的形式来提升性能。由于 Web 服务器可以自由水平扩展，使用多进程的形式来管理，可以完全解开 GIL 锁的问题。</p>

<p>但是 fork 指令效率低下。微软在 2019 年 HOTOS 上给出了一篇论文：<a href="https://www.microsoft.com/en-us/research/uploads/prod/2019/04/fork-hotos19.pdf">A fork() in the road</a>，和 spawn 相比，fork 模式会导致启动速度变得非常慢。为了缓解这一问题，在 Ruby 2.7 引入 <code class="language-plaintext highlighter-rouge">GC.compact</code> 后，通常需要执行多次 <code class="language-plaintext highlighter-rouge">compact</code> 来降低 fork 启动的消耗。进一步地，使用 Ractor 来替代多进程管理，可以更容易地传递消息，复用可冻结的常量，从而降低内存占用。</p>

<h2 id="总结">总结</h2>

<p>Ruby 3 打开了多线程的潘多拉盒子。我们可以更好利用多线程来改善性能。但是看着 CPU Profiler 下不同线程调用会导致 CPU IPC 下降和缓存命中下降，对程序调优也提出了更高的要求。</p>

<p>我们边走边看吧。</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/ruby" class="page__taxonomy-item p-category" rel="tag">Ruby</a><span class="sep">, </span>
    
      <a href="/tags/%E7%BC%96%E7%A8%8B" class="page__taxonomy-item p-category" rel="tag">编程</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2020-11-17T15:30:24+08:00">November 17, 2020</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Ractor+%E4%B8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B+Ruby+%E7%A8%8B%E5%BA%8F%E6%8C%87%E5%8D%97%20https%3A%2F%2Fcoderemixer.com%2F2020%2F11%2F17%2Fruby-3-ractor-guide" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcoderemixer.com%2F2020%2F11%2F17%2Fruby-3-ractor-guide" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://coderemixer.com/2020/11/17/ruby-3-ractor-guide" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2020/11/10/how-anti-reflective-coating-works" class="pagination--pager" title="真的存在没有反光的眼镜吗？
">Previous</a>
    
    
      <a href="/2020/12/22/ruby-3-fiber-scheduler-evt-dev-log-en" class="pagination--pager" title="Developing Fiber Scheduler for Ruby 3
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
  
  <h2 class="page__related-title">You May Also Enjoy</h2>
  <div class="grid__wrapper">
    
    
    
      
      
      
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/06/25/diophantine-equation" rel="permalink">1/x + 1/y = 8/79 的整数解
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-06-25T14:30:00+08:00">June 25, 2025</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">刷到个视频，讲的是不定方程 $\frac{1}{x} + \frac{1}{y} = \frac{8}{79}$ 的解。当然我觉得题目漏了个条件，是整数解，因为如果不加整数条件的话，该问题的解是无穷多的。
</p>
  </article>
</div>

    
      
      
      
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/06/22/siff-david-lynch" rel="permalink">上海国际电影节大卫林奇通宵场观影感受
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-06-22T17:03:00+08:00">June 22, 2025</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">昨天 11 点看了上海国际电影节 6 个小时的大卫林奇通宵场散场电影连映《橡皮头》、《妖夜慌踪》、《穆赫兰道》（ Eraserhead + Lost Highway + Mulholland Drive）。观影完之后，有一位观众（下面简称 A）在电影院发表了对《橡皮头》放映非常大的意见。A 的核心观点是觉得杜比厅...</p>
  </article>
</div>

    
      
      
      
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/02/28/how-quantum-computing-works" rel="permalink">当我们吹嘘量子并行计算的时候
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-02-28T13:00:00+08:00">February 28, 2025</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">昨天晚上和老金聊到微软的 Majorana 1 的时候，我说了一段关于量子计算研究的评论。我觉得很有必要再说一次。
</p>
  </article>
</div>

    
      
      
      
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/01/28/thoughts-about-deepseek" rel="permalink">写在甲辰年末
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-01-28T23:00:00+08:00">January 28, 2025</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">今天有朋友问我：「你居然没点评 DeepSeek，不习惯。」
好吧，看来大家还是喜欢看我大放厥词。
</p>
  </article>
</div>

    
      
      
      
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://coderemixer.com">Coderemixer 代码混音师</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FHQPM1YDDJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FHQPM1YDDJ', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://coderemixer.com/2020/11/17/ruby-3-ractor-guide";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/2020/11/17/ruby-3-ractor-guide"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://coderemixer.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  




  </body>
</html>
